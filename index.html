<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ğŸµ ã¾ã£ã¡ã‚ƒAIã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (Qwen2.5-0.5Bæ¥ç¶š)</title>
    <!-- Tailwind CSSã‚’èª­ã¿è¾¼ã‚“ã§ã€ç¾ã—ã„UIã‚’ä½œã‚‹ã‚ˆï¼ -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* ã¾ã£ã¡ã‚ƒç‹å›½ã®ãƒ†ãƒ¼ãƒã‚«ãƒ©ãƒ¼ */
        :root {
            --matcha-green: #9CCC65; /* ãƒ©ã‚¤ãƒ ã‚°ãƒªãƒ¼ãƒ³ */
            --matcha-dark: #689F38; /* ã‚ªãƒªãƒ¼ãƒ–ã‚°ãƒªãƒ¼ãƒ³ */
            --matcha-bg: #F9FFF7;   /* ã»ã¼ç™½ã®èƒŒæ™¯ */
        }
        body {
            font-family: 'Inter', sans-serif;
            background-color: var(--matcha-bg);
        }
        .matcha-card {
            box-shadow: 0 10px 30px rgba(104, 159, 56, 0.3);
            border: 1px solid var(--matcha-green);
        }
        .matcha-btn {
            background-color: var(--matcha-dark);
            transition: transform 0.1s;
        }
        .matcha-btn:hover {
            background-color: #7CB342;
            transform: translateY(-1px);
        }
        /* ãƒãƒ£ãƒƒãƒˆãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        .user-bubble {
            background-color: #e6fffa; /* è–„ã„æ°´è‰² */
            border-bottom-right-radius: 0;
        }
        .ai-bubble {
            background-color: var(--matcha-green); /* ã¾ã£ã¡ã‚ƒè‰² */
            color: white;
            border-bottom-left-radius: 0;
        }
    </style>
</head>
<body class="min-h-screen flex items-center justify-center p-4">

    <!-- ãƒ¡ã‚¤ãƒ³ã®AIãƒãƒ£ãƒƒãƒˆã‚«ãƒ¼ãƒ‰ -->
    <div class="matcha-card bg-white w-full max-w-2xl p-8 rounded-2xl">
        <h1 class="text-3xl font-extrabold text-center mb-6" style="color: var(--matcha-dark);">
            ã¾ã£ã¡ã‚ƒAI ğŸµ
        </h1>
        
        <!-- å¿œç­”è¡¨ç¤ºã‚¨ãƒªã‚¢ï¼ˆãƒãƒ£ãƒƒãƒˆå±¥æ­´è¡¨ç¤ºç”¨ï¼‰ -->
        <div class="mt-8 mb-6 h-96 overflow-y-auto p-4 border-2 border-gray-200 rounded-lg" id="chat_history_container">
            <!-- ã“ã“ã«ä¼šè©±ã®å±¥æ­´ãŒç©ã¿é‡ãªã‚‹ã‚ˆï¼ -->
            <div class="text-center text-gray-500 my-4">ã•ã‚ã€è³ªå•ã‚’å…¥åŠ›ã—ã¦ã€ã¾ã£ã¡ã‚ƒAIã¨ä¼šè©±ã‚’å§‹ã‚ã‚ˆã†ï¼</div>
        </div>
        
        <!-- è³ªå•å…¥åŠ›ã‚¨ãƒªã‚¢ -->
        <div class="mb-4">
            <label for="input_field_id" class="block text-sm font-medium mb-2" style="color: var(--matcha-dark);">è³ªå•ã‚’å…¥åŠ›ã—ã¦ã­ï¼</label>
            <textarea id="input_field_id" rows="2" 
                      class="w-full p-3 border-2 border-gray-300 rounded-lg focus:ring-2 focus:ring-opacity-50 resize-none" 
                      style="border-color: var(--matcha-green); outline: none;" 
                      placeholder=""></textarea>
        </div>

        <!-- å¿œç­”ãƒœã‚¿ãƒ³ -->
        <button id="submit_button" onclick="sendQuestionToAI()" 
                class="matcha-btn text-white w-full py-3 rounded-xl font-bold text-lg hover:shadow-lg">
            ã¾ã£ã¡ã‚ƒAIã«é€ä¿¡
        </button>

        <p id="loading_message" class="text-center text-orange-500 font-semibold mt-4 hidden">
            ğŸ¢ AIãŒè€ƒãˆã¦ã‚‹ã‚ˆï¼å°‘ã—å¾…ã£ã¦ã­...
        </p>

    </div>

    <script>
        // AIã‚µãƒ¼ãƒãƒ¼ã®ã‚¢ãƒ‰ãƒ¬ã‚¹
        const AI_SERVER_URL = 'http://localhost:8001/generate'; 
        
        // â˜…â˜…â˜… ä¼šè©±å±¥æ­´ã‚’ä¿æŒã™ã‚‹ãƒªã‚¹ãƒˆï¼ã“ã‚ŒãŒAIã®è¨˜æ†¶ã ã‚ˆï¼ â˜…â˜…â˜…
        let conversationHistory = []; 

        const inputField = document.getElementById('input_field_id');
        const chatContainer = document.getElementById('chat_history_container'); // å±¥æ­´è¡¨ç¤ºã‚¨ãƒªã‚¢ã«å¤‰æ›´
        const loadingMessage = document.getElementById('loading_message');
        const submitButton = document.getElementById('submit_button');

        // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ãƒãƒ£ãƒƒãƒˆã‚¨ãƒªã‚¢ã«è¿½åŠ ã™ã‚‹ãƒ˜ãƒ«ãƒ‘ãƒ¼é–¢æ•°
        function addMessageToChat(role, content) {
            const isUser = role === 'user';
            const bubble = document.createElement('div');
            bubble.className = `p-3 my-3 max-w-[85%] rounded-xl whitespace-pre-wrap ${isUser ? 'ml-auto user-bubble' : 'mr-auto ai-bubble'}`;
            
            const roleLabel = document.createElement('p');
            roleLabel.className = `font-bold text-xs mb-1 ${isUser ? 'text-gray-600' : 'text-white'}`;
            roleLabel.innerText = isUser ? 'ã‚ãªãŸ' : 'ã¾ã£ã¡ã‚ƒAI';

            const contentText = document.createElement('p');
            contentText.innerText = content;

            bubble.appendChild(roleLabel);
            bubble.appendChild(contentText);
            chatContainer.appendChild(bubble);

            // ã‚¹ã‚¯ãƒ­ãƒ¼ãƒ«ã‚’ä¸€ç•ªä¸‹ã«ã™ã‚‹
            chatContainer.scrollTop = chatContainer.scrollHeight;
        }


        // AIã‚µãƒ¼ãƒãƒ¼ã«è³ªå•ã‚’é€ä¿¡ã™ã‚‹é–¢æ•°
        async function sendQuestionToAI() {
            const prompt = inputField.value.trim();
            if (!prompt) {
                alert('è³ªå•ã‚’å…¥åŠ›ã—ã¦ã­ï¼');
                return;
            }
            
            // 1. è³ªå•ã‚’å±¥æ­´ã«è¿½åŠ ï¼†ç”»é¢ã«è¡¨ç¤º
            addMessageToChat('user', prompt);
            
            // â˜…â˜…â˜… 2. å±¥æ­´ãƒªã‚¹ãƒˆã«ç¾åœ¨ã®ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®è³ªå•ã‚’è¿½åŠ ï¼ â˜…â˜…â˜…
            conversationHistory.push({ role: 'user', content: prompt });
            
            // UIã‚’ãƒ­ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ä¸­ã«åˆ‡ã‚Šæ›¿ãˆã‚‹
            inputField.value = ''; // å…¥åŠ›æ¬„ã‚’ã‚¯ãƒªã‚¢
            loadingMessage.classList.remove('hidden');
            submitButton.disabled = true;

            const requestData = {
                prompt: prompt,
                max_tokens: 500,
                temperature: 0.7,
                history: conversationHistory // â˜…â˜…â˜… 3. å±¥æ­´å…¨ä½“ã‚’ãƒªã‚¯ã‚¨ã‚¹ãƒˆã«å«ã‚ã‚‹ï¼ â˜…â˜…â˜…
            };

            try {
                // fetchã§å›ã®AIã‚µãƒ¼ãƒãƒ¼ã«æ¥ç¶šï¼
                const response = await fetch(AI_SERVER_URL, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify(requestData)
                });

                if (!response.ok) {
                    throw new Error(`HTTPã‚¨ãƒ©ãƒ¼ï¼ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: ${response.status}`);
                }

                const data = await response.json();
                
                // 4. AIã‹ã‚‰ã®å¿œç­”ã‚’ç”»é¢ã«è¡¨ç¤ºï¼
                const aiResponseText = data.response;
                addMessageToChat('assistant', aiResponseText);

                // â˜…â˜…â˜… 5. AIã®å¿œç­”ã‚‚å±¥æ­´ãƒªã‚¹ãƒˆã«è¿½åŠ ã—ã¦è¨˜æ†¶ã‚’æ›´æ–°ï¼ â˜…â˜…â˜…
                conversationHistory.push({ role: 'assistant', content: aiResponseText });

            } catch (error) {
                // é€šä¿¡å¤±æ•—ï¼ã‚µãƒ¼ãƒãƒ¼ãŒèµ·å‹•ã—ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã­ï¼
                console.error('APIé€šä¿¡ã‚¨ãƒ©ãƒ¼:', error);
                const errorMessage = 'ã”ã‚ã‚“ï¼AIã‚µãƒ¼ãƒãƒ¼ã¨é€šä¿¡ã§ããªã‹ã£ãŸã‚ˆ...ğŸ˜­ ã‚µãƒ¼ãƒãƒ¼ï¼ˆAnaconda Promptã®ç”»é¢ï¼‰ãŒå‹•ã„ã¦ã„ã‚‹ã‹ç¢ºèªã—ã¦ã­ï¼';
                addMessageToChat('assistant', errorMessage);
                
                // ã‚¨ãƒ©ãƒ¼æ™‚ã¯ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æœ€å¾Œã®è³ªå•ã‚’å±¥æ­´ã‹ã‚‰å‰Šé™¤ï¼ˆæœªå›ç­”ã®ãŸã‚ï¼‰
                conversationHistory.pop();

            } finally {
                // UIã‚’å…ƒã«æˆ»ã™
                loadingMessage.classList.add('hidden');
                submitButton.disabled = false;
            }
        }

        // Enterã‚­ãƒ¼ã§é€ä¿¡ã§ãã‚‹ã‚ˆã†ã«ã™ã‚‹
        inputField.addEventListener('keydown', (e) => {
            if (e.key === 'Enter' && !e.shiftKey) {
                e.preventDefault(); // æ”¹è¡Œã‚’é˜²ã
                sendQuestionToAI();
            }
        });
    </script>
</body>
</html>
